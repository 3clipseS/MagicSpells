plugins {
    id("org.jetbrains.kotlin.jvm") version "1.7.10"
    id("io.papermc.paperweight.userdev") version "1.3.8"
    id("com.github.johnrengelman.shadow") version "7.1.2"
    id("dev.magicspells.mspaperweight")
}

dependencies {
    shadow(group: "org.apache.commons", name: "commons-math3", version: "3.6.1")
    shadow(group: "com.github.Chronoken", name: "EffectLib", version: "1be5ee7fd7")
    shadow(group: "co.aikar", name: "acf-paper", version: "0.5.1-SNAPSHOT")
    shadow(group: "org.jetbrains.kotlin", name: "kotlin-stdlib-jdk8", version: "1.7.10")

    implementation(group: "com.comphenix.protocol", name: "ProtocolLib", version: "4.8.0") { transitive = false }
    implementation(group: "com.github.libraryaddict", name: "LibsDisguises", version: "v10.0.25") { transitive = false }
    implementation(group: "com.github.MilkBowl", name: "VaultAPI", version: "master-SNAPSHOT") { transitive = false }
    implementation(group: "com.github.PlaceholderAPI", name: "PlaceholderAPI", version: "master-SNAPSHOT") { transitive = false }
    implementation(group: "com.github.TechFortress", name: "GriefPrevention", version: "master-SNAPSHOT") { transitive = false }
    implementation(group: "com.github.Xezard", name: "XGlow", version: "1.0.9") {
        exclude(module: "XGlowPlugin")
        exclude(module: "XGlowExample")
    }

    implementation(group: "com.github.EngineHub", name: "WorldGuard", version: "master") {
        exclude(module: "worldguard-libs")
    }

    implementation(group: "com.github.EngineHub", name: "WorldEdit", version: "master") {
        transitive = false
        exclude(module: "ap")
        exclude(module: "cli")
        exclude(module: "fabric")
        exclude(module: "forge")
        exclude(module: "sponge")
        exclude(module: "worldedit-cli")
        exclude(module: "worldedit-sponge")
        exclude(module: "worldedit-forge-mc1.16.1")
        exclude(module: "worldedit-fabric-mc1.16.1")
    }

}

shadowJar {
    configurations = [project.configurations.shadow]

    setArchivesBaseName("MagicSpells")
    relocate("org.apache.commons.math3", "com.nisovin.magicspells.shaded.org.apache.commons")
    relocate("de.slikey.effectlib", "com.nisovin.magicspells.shaded.effectlib")
    relocate("ru.xezard.glow", "com.nisovin.magicspells.shaded.xglow")
    relocate("kotlin", "com.nisovin.magicspells.shaded.kotlin")
    relocate("co.aikar.commands", "com.nisovin.magicspells.shaded.acf")
    relocate("co.aikar.locales", "com.nisovin.magicspells.shaded.locales")
    archiveClassifier.set("")
}

compileKotlin {
    kotlinOptions {
        jvmTarget = "17"
        javaParameters = true
    }
}

compileTestKotlin {
    kotlinOptions {
        jvmTarget = "17"
    }
}

artifacts {
    archives shadowJar
}

publishing {
    publications {
        maven(MavenPublication) {
            from components.java
        }
    }
}

tasks {
    build {
        dependsOn(reobfJar)
    }
}
